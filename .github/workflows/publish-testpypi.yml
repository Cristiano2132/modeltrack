# name: Build, Test and Publish Python 🐍 Package

# on:
#   push:
#     branches: [main]        # Publica no TestPyPI em pushes na branch main
#   # Para publicar no PyPI real via tags, descomente:
#   # push:
#   #   tags:
#   #     - "v*"

# permissions:
#   id-token: write
#   contents: read

# jobs:
#   build:
#     name: 🛠️ Build, Test & Check Coverage
#     runs-on: ubuntu-latest

#     steps:
#       - name: 📥 Checkout code
#         uses: actions/checkout@v4

#       - name: 🐍 Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.10"

#       - name: 📦 Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install build
#           pip install -e .[dev]   # instala pacote + dependências de dev (pytest, coverage)
#           pip install pytest pytest-cov

#       - name: ✅ Run tests with coverage
#         run: |
#           pytest --cov=src/expdespy --cov-report=term-missing --cov-fail-under=80

#       - name: 🏗️ Build package
#         run: python -m build

#       - name: 📤 Upload dist artifacts
#         uses: actions/upload-artifact@v4
#         with:
#           name: python-package-distributions
#           path: dist/

#   publish-to-testpypi:
#     name: 🚀 Publish to TestPyPI
#     needs: build
#     runs-on: ubuntu-latest
#     environment:
#       name: testpypi
#       url: https://test.pypi.org/p/expdespy

#     steps:
#       - name: 📥 Download dist
#         uses: actions/download-artifact@v4
#         with:
#           name: python-package-distributions
#           path: dist/

#       - name: 🚀 Publish to TestPyPI
#         uses: pypa/gh-action-pypi-publish@release/v1
#         with:
#           repository-url: https://test.pypi.org/legacy/
#         env:
#           TWINE_USERNAME: __token__
#           TWINE_PASSWORD: ${{ secrets.TEST_PYPI_API_TOKEN }}

#   publish-to-pypi:
#     name: 🚀 Publish to PyPI
#     if: startsWith(github.ref, 'refs/tags/')
#     needs: build
#     runs-on: ubuntu-latest
#     environment:
#       name: pypi
#       url: https://pypi.org/p/expdespy

#     steps:
#       - name: 📥 Download dist
#         uses: actions/download-artifact@v4
#         with:
#           name: python-package-distributions
#           path: dist/

#       - name: 🚀 Publish to PyPI
#         uses: pypa/gh-action-pypi-publish@release/v1